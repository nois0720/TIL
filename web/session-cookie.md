# 세션(Session)과 쿠키(Cookie)

세션과 쿠키에 대해서 정리하고 싶은 생각이 마음 한편에 있었는데. 드디어 이 둘을 좀 명확하게 구분하여 정리해보려고 한다.

먼저 결론부터 말하면, 세션이란 일정 시간 동안 특정 상태정보를 유지하는 것을 말하고 쿠키는 유저의 정보를 사용자의 시스템에 저장하는 작은 정보조각이다.

한 문장으로 정리하고자 했지만 사실 위에 있는 문장만으로는 쉽게 이해되지 않는다. 무슨 말일까?


## 등장배경

먼저, 세션과 쿠키에 대해서 이해하기 전에, 이런 세션과 쿠키가 등장하게 된 배경을 이해할 필요가 있다. HTTP의 특징 중 하나는 바로 connectless. 즉 비 연결성이다. 웹의 특성상, 불특정 다수의 사용자가 서버에 접근한다. 만약 많은 사용자의 connection을 유지하게 하면 서버 입장에서는 리소스 관리에 있어서 상당한 부담이 된다. 따라서 HTTP는 Request가 있으면, 서버는 해당 요청에 대한 응답을 하고 바로 TCP연결을 종료하는 Connectless라는 특징을 반영하여 설계되었다.

하지만 이런 connectless는 몇 가지 문제를 야기시킨다. 매번 새롭게 연결을 해야하는 데에서 발생하는 오버헤드 문제도 있지만 특히 **Stateless**. 즉, 클라이언트의 상태 정보를 가질 수 없다는 문제점이 발생한다. HTTP의 connectless한 특징 때문에, 서버는 클라이언트의 정보를 유지할 수 없다.


## 쿠키

이를 해결하기 위해, 서버에서는 클라이언트들에게 쿠키를 설정하고, 쿠키를 할당받은 클라이언트들은 서버에게 요청을 할 때 자신이 가지고 있는 쿠키값을 Request에 첨부하여 보내도록 하였다. 서버는 이 쿠키값을 통해 클라이언트의 정보를 식별할 수 있게 된다.

서버에서 설정해주는 쿠키 정보는 클라이언트에 저장되는데, 서버와의 연결고리 역할을 하는 데이터들이 마치 과자 부스러기처럼 남아있다고 해서 쿠키라고 부르게 되었다고 한다. 하지만 쿠키 내용이 클라이언트에 고스란히 남기 때문에, 클라이언트에 접근할 수 있는 어떠한 사용자라도 이를 확인할 수 있다는 점 때문에 보안적으로 취약하다.

### 쿠키의 특징

1. 쿠키에 '만료 기간'이 있으면 HDD에, 없으면 메모리에 저장한다.
	* 메모리에 저장하는 경우 쿠키 값을 전달받은 프로세스의 메모리 영역에 저장한다. (브라우저 등)
	
2. 쿠키는 개인정보, 사용자의 행위, 팝업 설정, 세션 토큰 등을 저장한다.
	* 개인정보, 사용자의 행위(접근한 웹페이지 등), 팝업 설정 등은 HDD에 저장된다.
	* 세션 토큰은 만료 기간이 없기 때문에, 해당 프로세스의 메모리에 저장된다. 세션토큰은 이 무엇인지는 아래의 세션 파트에서 다룬다.

3. 쿠키는 일반 텍스트로 이루어져 있고, 암호화 되어있지 않다.
	* 이러한 문제를 해결하기 위해 일반적으로 쿠키값을 자체적으로 암호화해서 사용한다.

4. 일반적인 브라우저에서 최대 4KB의 텍스트 정보를 담을 수 있으며, 하나의 사이트에서 20개만 허용된다. 또한 모든 사이트를 통틀어서 300개로 제한된다.
	* 이 범위를 넘을 경우 가장 오래된 쿠키부터 삭제한다.
	* 여기서 말한 개수 등은 정확한 값이 아닐 수도 있다.

## 세션

HTTP 1.1에서는, HTTP의 connectless라는 기존의 성질을 과감히 버리고 연결을 유지시킬 수 있는 세션이 등장하게 되었다. 클라이언트가 서버에 Request하면 서버에서는 해당 클라이언트에 대한 세션 토큰을 생성하고 이를 서버에 저장한다. 또한, Response과정에서 클라이언트에게 보내어 클라이언트 역시 웹 브라우저 등에 저장하게 한다.

이 후 클라이언트에서는 모든 Request에 해당 세션토큰을 첨부하고, 서버는 자신이 가진 세션토큰과 클라이언트측의 세션토큰과 매칭하여 클라이언트의 정보를 식별할 수 있게 된다. 서버가 이러한 정보를 관리하므로 보안적인 측면에서 좀 더 우수하다.
