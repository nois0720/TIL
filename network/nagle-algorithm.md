# 네이글 알고리즘

예전에 회사에서 서버 엔진 예제 작업을 하던 중, Nagle Algorithm 옵션을 ON/OFF할 수 있는 기능이 있었다. 한동안 잊고 있었는데 오랜만에 해당 내용을 접할 기회가 생겨 정리하게 되었다.

TCP 통신을 한다고 가정해보자. 클라이언트는 서버에게 HELLO 라는 데이터를 보내기를 원한다. 그렇다면, 클라이언트에서는 먼저 'H'라는 데이터를 패킷으로 만들어서 출력 버퍼로 보낸다. 그리고 해당 패킷에 대한 ACK 수신 여부와는 관계없이 E, L, L, O 순으로 데이터를 차례로 보내게 된다. 즉, ACK의 수신 시기는 관계 없으며 받기만 하면 된다는 것을 의미한다.

## Nagle Algorithm

Nagle Algorithm은 TCP의 `Effective TCP`을 원칙으로 한다. 그래서 위의 예처럼 조금씩 여러번 보내지 말고 한 번에 많이 보내어 Effective TCP를 실현한다. 좀 더 정확히 말하자면, **ACK을 받을 때까지 출력버퍼에 데이터를 저장해두었다가 ACK을 받으면 쌓아두었던 버퍼의 데이터를 한번에 모두 패킷으로 만들어 보낸다.** 위의 예를 Nagle Algorithm으로 설명하자면, 클라이언트가 'H'를 보낸 후 바로 다음 데이터를 보내는 것이 아니라 출력버퍼에 쌓아둔다. 그리고 ACK이 오면 출력 버퍼에 저장된 'ELLO'를 보내는 것이다.

해당 글에서는 마치 TCP가 Nagle Algorithm을 디폴트로 사용하지 않으며 해당 알고리즘을 따로 사용해야 될 것처럼 적어두었으나 TCP 소켓은 Nagle Algorithm을 디폴트로 쓰고있다고 한다.

## 장점

같은 양의 데이터를 보낼 때, 패킷의 수가 적어진다. 따라서 네트워크의 효율성이 높아진다.

## 단점

Receiver가 ACK을 기다려야하므로 전송에 걸리는 시간이 느려질 수 있다. 따라서 서버나 네트워크에 부담을 적게 주는것보다 빠른 응답속도가 필요한 경우에는 Nagle Algorithm을 사용하지 않는 경우도 있다. (Realtime Service 등)
